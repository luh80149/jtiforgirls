<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>JTI é›™åœ’å¥³å­å‘¨æ—¥ç±ƒçƒè¯ç›Ÿ</title>

  <style>
    body { margin: 0; font-family: sans-serif; background: #fafafa; }
    header { text-align: center; padding: 10px 0; background: #222; color: #fff; }

    /* è¼ªæ’­ */
    .carousel { width: 100%; height: 300px; overflow: hidden; position: relative; }
    .carousel img { width: 100%; height: 300px; object-fit: cover; position: absolute; transition: opacity 1s; opacity: 0; }

    /* ä¸»é¸å–® */
    nav {
      display: flex;
      justify-content: center;
      background: #333;
      position: relative;      /* ä¿è­‰ submenu ä»¥ nav ç‚ºåŸºæº– */
      z-index: 5;             /* è®“ nav ç«™åœ¨è¼ªæ’­ä¸Šæ–¹ */
    }

    nav button, nav a {
      flex: 1;
      padding: 12px;
      border: none;
      background: #333;
      color: #fff;
      cursor: pointer;
      font-size: 16px;
      text-decoration: none;
      text-align: center;
      display: flex;
      justify-content: center;
      align-items: center;
      white-space: nowrap; 
    }

    nav button:hover, nav a:hover { background: #444; }

    /* è®“ YouTube é€£çµä¿æŒå…¶ç‰¹è‰²é¡è‰² */
    nav a.youtube-link {
        background: #CC0000;
    }
    nav a.youtube-link:hover {
        background: #E60000;
    }

    /* å­é¸å–® */
    .submenu {
      display: none; /* é è¨­éš±è— */
      background: #444;
      padding: 10px 0;
      position: absolute;
      width: 100%;
      left: 0;
      text-align: center;
      z-index: 4;
    }

    .submenu-inner {
      display: flex;
      justify-content: center;
      max-width: 800px;
      margin: 0 auto;
      gap: 10px; /* æŒ‰éˆ•é–“è· */
    }    

    .submenu button {
      color: #fff;
      background: #555;
      border: none;
      margin: 0 6px;
      padding: 8px 18px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 15px;
    }

    .submenu button:hover { background: #666; }

    .content { padding: 15px; max-width: 1000px; margin: auto; }

    table { width: 100%; border-collapse: collapse; margin-top: 10px; background:white; }
    table th, table td { border: 1px solid #ccc; padding: 6px; text-align: center; }
    table th { background: #eee; font-weight: bold; }

    h3 { margin-top: 0; }

    /* ğŸŒŸ æœ€æ–°æ¶ˆæ¯åˆ—è¡¨æ¨£å¼ */
    .news-item {
        padding: 10px;
        margin-bottom: 10px;
        border-left: 5px solid #6c757d;
        background: #f0f0f0;
        border-radius: 4px;
    }
    .news-item.urgent {
        border-left: 5px solid #333;
        background: #e8e8e8;
    }
    .news-subject { font-weight: bold; color: #333; margin-bottom: 5px; }
    .news-date { font-size: 0.8em; color: #6c757d; display: block; margin-bottom: 5px; }
    .news-link { color: #495057; font-weight: bold; text-decoration: none; }
    .news-link:hover { text-decoration: underline; }
  </style>
</head>

<body>

 <!-- è¼ªæ’­ -->
  <div class="carousel" id="carousel"></div>

  <header>
    <h2>JTIé›™åœ’å¥³å­å‘¨æ—¥ç±ƒçƒè¯ç›Ÿ</h2>
  </header>

  <!-- â­ ä¸»é¸å–® -->
  <nav>
    <button onclick="showPage('news')">æœ€æ–°æ¶ˆæ¯</button>

    <!-- â­ æ–°å¢ï¼šè³½ç¨‹æˆ°ç¸¾å­é¸å–®è§¸ç™¼ -->
    <button onclick="toggleSubmenu()">è³½ç¨‹æˆ°ç¸¾</button>

    <button onclick="showPage('history')">æ­·å±†æˆç¸¾</button>

    <!-- â­ YouTube Iconï¼ˆè®Šæˆç´…è‰² iconï¼‰ -->
    <a href="https://www.youtube.com/@MCChuang" target="_blank" rel="noopener noreferrer">
      â–¶ï¸ è³½äº‹é »é“
    </a>
  </nav>

  <!-- â­ å­é¸å–®ï¼ˆæŠ˜ç–Šå¼ï¼‰ -->
  <div class="submenu" id="submenu">
    <button onclick="showPage('schedule')">æœ¬å­£è³½ç¨‹</button>
    <button onclick="showPage('standing')">ç›®å‰æˆ°ç¸¾</button>
    <button onclick="showPage('teams')">æˆ°ç¸¾æŸ¥è©¢</button>
  </div>

  <div class="content" id="contentArea"></div>

<script>
  
// ğŸŒŸ Google Sheetsï¼ˆä½ çš„ CSV é€£çµï¼‰
const CSV_URL =
  "https://docs.google.com/spreadsheets/d/e/2PACX-1vQJ5ekQkDeP54OqrFvqYxelOI05zCqtoDbCfEbYkLJF58hz_vsQb67FS0uasXZQunro8DS3EL4ZP8yO/pub?gid=0&single=true&output=csv";

// ğŸŒŸ æœ€æ–°æ¶ˆæ¯è³‡æ–™é™£åˆ—
const NEWS_ITEMS = [
  {
    date: "2025/12/01",
    subject: "ğŸ“¢ 2026å¹´ç¬¬ä¸€å­£æ¯”è³½é–‹å§‹å ±åï¼",
    content: "2026å¹´ç¬¬ä¸€å­£è¯è³½å ±åæ­£å¼å•Ÿå‹•ï¼è«‹é»æ“Šæ­¤è™•é€²å…¥ Google è¡¨å–®å®Œæˆå ±åæ‰‹çºŒã€‚",
    link: "https://forms.gle/kNBJZmj9Degpma3WA",
    isUrgent: true 
  },
  {
    date: "2025/12/01",
    subject: "å¾µå¾µå¾µï¼šå°‹æ‰¾å‹èª¼è³½éšŠä¼",
    content: "12/21ã€12/28 å‹èª¼è³½å°šæœ‰å ±ååé¡ï¼ä¸é™ç”·å¥³ç”ŸçƒéšŠï¼Œå°‡ä¾æ€§åˆ¥åˆ†çµ„ï¼Œæˆ‘å€‘èª æ‘¯é‚€è«‹å„éšŠè¸´èºå ±åï¼Œä¸€èµ·åƒèˆ‡å‹èª¼è³½ã€åˆ‡ç£‹çƒæŠ€ã€å…±å‰µç²¾å½©æ¯”è³½ğŸ‰ æ¯”è³½ç”±è­‰ç…§è£åˆ¤æŒæ§ã€å°ˆæ¥­è¨˜éŒ„å°å”åŠ©ï¼Œä¸¦å…¨ç¨‹éŒ„å½±ï¼Œç²¾å½©ä¸æ¼æ‹ï¼Œæ„è€…è«‹æ´½è¯è³½çª—å£ã€‚",
    link: "https://forms.gle/kNBJZmj9Degpma3WA",
    isUrgent: false
  },

];

// ğŸŒŸ è¼ªæ’­ï¼ˆè‡ªå‹•è¼‰å…¥ assets/1.jpg ~ assets/20.jpgï¼‰
const carouselDiv = document.getElementById("carousel");
let carouselIndex = 0;
const carouselImages = [];

const MAX_IMAGES = 20; // ä½ é æœŸæœ€å¤šæ”¾å¹¾å¼µ

for (let i = 1; i <= MAX_IMAGES; i++) {
  const img = document.createElement("img");
  img.src = `assets/${i}.jpg`;

  img.onload = () => {
    if (carouselImages.length === 0) {
      img.style.opacity = 1;
    }
    carouselDiv.appendChild(img);
    carouselImages.push(img);
  };

  // å¦‚æœåœ–ç‰‡ä¸å­˜åœ¨ï¼Œç›´æ¥å¿½ç•¥
  img.onerror = () => {};
}

setInterval(() => {
  if (carouselImages.length <= 1) return;

  carouselImages[carouselIndex].style.opacity = 0;
  carouselIndex = (carouselIndex + 1) % carouselImages.length;
  carouselImages[carouselIndex].style.opacity = 1;
}, 3000);


// ğŸŒŸ ä¸»/å­é¸å–® toggle
function toggleSubmenu() {
  const menu = document.getElementById("submenu");
  menu.style.display = (menu.style.display === "block") ? "none" : "block";
}

// ğŸŒŸä¸»é åˆ‡æ›ï¼ˆä½ çš„åŸå§‹åŠŸèƒ½ï¼‰
function showPage(page) {
  // æ”¶èµ·å­é¸å–®
  document.getElementById("submenu").style.display = "none";

  if (page === "news") renderNews();
  if (page === "schedule") renderSchedule();
  if (page === "standing") renderStanding();
  if (page === "teams") renderTeamSearch();
  if (page === "history") renderHistory();
}


// ğŸŒŸ è®€å– CSV
async function fetchCSV() {
  const res = await fetch(CSV_URL);
  const text = await res.text();
  return text.split(/\r?\n/).map(r => r.split(","));
}

// ====================================================================
// â­ 0ï¼‰æœ€æ–°æ¶ˆæ¯
// ====================================================================
function renderNews() {
    const contentArea = document.getElementById("contentArea");
    let newsHtml = '<h3>æœ€æ–°æ¶ˆæ¯</h3>';

    NEWS_ITEMS.forEach(item => {
        const urgencyClass = item.isUrgent ? ' urgent' : '';
        let linkHtml = '';
        
        if (item.link) {
            linkHtml = `
                <a 
                    href="${item.link}" 
                    target="_blank" 
                    rel="noopener noreferrer" 
                    class="news-link"
                >
                    [æŸ¥çœ‹è©³æƒ…...]
                </a>
            `;
        }
        
        newsHtml += `
            <div class="news-item${urgencyClass}">
                <span class="news-date">${item.date}</span>
                <div class="news-subject">${item.subject}</div>
                <p>${item.content}</p>
                ${linkHtml}
            </div>
        `;
    });
    
    contentArea.innerHTML = newsHtml;
}


// ====================================================================
// â­ 1ï¼‰è³½ç¨‹è¡¨
// ====================================================================
function toYYYYMM(dateStr) {
  return dateStr.slice(0, 6);
}

function parseDate(d) {
  return new Date(d.replace(/\//g, "-"));
}

async function renderSchedule() {
  const rows = await fetchCSV();
  const headers = rows[0];
  let data = rows.slice(1).filter(r => r.length > 1);

  data.sort((a, b) => parseDate(a[0]) - parseDate(b[0]));

  const months = [...new Set(data.map(r => toYYYYMM(r[0])))];

  let html = `<h3>è³½ç¨‹è¡¨</h3>
  <label>ä¾æœˆä»½ç¯©é¸ï¼š
    <select id="monthFilter" onchange="filterByMonth()">
      <option value="all">å…¨éƒ¨</option>
  `;

  months.forEach(m => html += `<option value="${m}">${m}</option>`);
  html += `</select></label>`;

  html += `
    <table id="scheduleTable">
      <thead><tr>${headers.map(h => `<th>${h}</th>`).join("")}</tr></thead>
      <tbody>
  `;

  data.forEach(r => html += `<tr>${r.map(x => `<td>${x}</td>`).join("")}</tr>`);
  html += `</tbody></table>`;

  document.getElementById("contentArea").innerHTML = html;

  window.fullSchedule = data;
}

function filterByMonth() {
  const m = document.getElementById("monthFilter").value;
  const tbody = document.querySelector("#scheduleTable tbody");
  tbody.innerHTML = "";

  window.fullSchedule.forEach(r => {
    if (m === "all" || toYYYYMM(r[0]) === m) {
      tbody.innerHTML += `<tr>${r.map(x => `<td>${x}</td>`).join("")}</tr>`;
    }
  });
}



// ====================================================================
// â­ 2ï¼‰ç›®å‰æˆ°ç¸¾ï¼ˆä½ æ–°å¢çš„é é¢ï¼‰
// ====================================================================
async function renderStanding() {
  const rows = await fetchCSV();
  const data = rows.slice(1).filter(r => r.length > 1);

  // æ¬„ä½ï¼šæ—¥æœŸã€æ™‚é–“ã€çµ„åˆ¥ã€éšŠä¼æ·ºã€éšŠä¼æ·±ã€æ¯”æ•¸ã€å‹éšŠ
  const GROUP = 2, LIGHT = 3, DARK = 4, SCORE = 5, WINNER = 6;

  // ğŸ”¥ æ‰¾å‡ºæ‰€æœ‰éšŠä¼ã€ä¾çµ„åˆ¥åˆ†é¡
  const groupTeams = { A: new Set(), B: new Set() };

  data.forEach(r => {
    const g = r[GROUP]?.trim();
    if (g === "Açµ„") {
      groupTeams.A.add(r[LIGHT]);
      groupTeams.A.add(r[DARK]);
    } else if (g === "Bçµ„") {
      groupTeams.B.add(r[LIGHT]);
      groupTeams.B.add(r[DARK]);
    }
  });

  // è½‰æˆç‰©ä»¶æ ¼å¼ç´€éŒ„æˆ°ç¸¾
  function initStanding(teams) {
    const obj = {};
    teams.forEach(t => {
      obj[t] = { played: 0, win: 0, lose: 0, draw: 0 };
    });
    return obj;
  }

  const standingA = initStanding(groupTeams.A);
  const standingB = initStanding(groupTeams.B);

  // ğŸ”¥ è¨ˆç®—æˆ°ç¸¾
  data.forEach(r => {
    const g = r[GROUP].trim();
    const light = r[LIGHT];
    const dark = r[DARK];
    const winner = r[WINNER].trim();
    if (!winner) { // å¦‚æœå‹éšŠæ¬„ä½ç‚ºç©ºã€nullã€undefinedï¼Œå‰‡è·³éæ­¤å ´æ¯”è³½
      return; // ç¹¼çºŒä¸‹ä¸€å€‹è¿´åœˆ
    }

    const target = g === "Açµ„" ? standingA : standingB;

    target[light].played++;
    target[dark].played++;

    if (winner === "å¹³æ‰‹") {
      target[light].draw++;
      target[dark].draw++;
    } else {
      target[winner].win++;
      const loser = winner === light ? dark : light;
      target[loser].lose++;
    }
  });

  // ğŸ”¥ ç”Ÿæˆè¡¨æ ¼ HTML
  function buildTable(title, obj) {
    let html = `<h3>${title}</h3>`;
    html += `<table><thead>
      <tr><th>éšŠä¼åç¨±</th><th>å·²è³½å ´æ•¸</th><th>å‹å ´æ•¸</th><th>æ•—å ´æ•¸</th><th>å¹³æ‰‹å ´æ•¸</th></tr>
    </thead><tbody>`;

// 1. å–å¾—æ‰€æœ‰éšŠä¼åç¨± (éµ)
  const teams = Object.keys(obj);

  // 2. é€²è¡Œè¤‡é›œæ’åº
  teams.sort((a, b) => {
    const sA = obj[a]; // éšŠä¼ A çš„æˆ°ç¸¾
    const sB = obj[b]; // éšŠä¼ B çš„æˆ°ç¸¾

    // --- è¦å‰‡ 1: å‹å ´æ•¸å¤šçš„å…ˆ (é™åº) ---
    if (sA.win !== sB.win) {
      return sB.win - sA.win; // B - A: å¦‚æœ B æ¯”è¼ƒå¤§ (å‹å ´å¤š)ï¼Œå›å‚³æ­£æ•¸ï¼ŒB æ’åœ¨å‰é¢
    }

    // --- è¦å‰‡ 2: å·²è³½æ•¸å¤šçš„å…ˆ (é™åº) ---
    if (sA.played !== sB.played) {
      return sB.played - sA.played; // B - A: å¦‚æœ B æ¯”è¼ƒå¤§ (å·²è³½å¤š)ï¼Œå›å‚³æ­£æ•¸ï¼ŒB æ’åœ¨å‰é¢
    }

    // --- è¦å‰‡ 3: éšŠåæŒ‰ç­†ç•«å°åˆ°å¤§æ’åº (å‡åº) ---
    // ä½¿ç”¨ String.prototype.localeCompare é€²è¡Œä¸­æ–‡ç­†ç•«/å­—å…¸åºæ’åº
    // é è¨­å°±æ˜¯å‡åº (å°çš„åœ¨å‰é¢)ï¼Œå¦‚æœ a æ‡‰è©²åœ¨ b å‰é¢ï¼Œå›å‚³è² æ•¸
    return a.localeCompare(b, 'zh-Hans-TW', { sensitivity: 'base' });
  });

  // 3. æŒ‰ç…§æ’åºå¥½çš„ teams é™£åˆ—ä¾†ç”Ÿæˆ HTML
  teams.forEach(t => {
    const s = obj[t];
    html += `<tr>
      <td>${t}</td>
      <td>${s.played}</td>
      <td>${s.win}</td>
      <td>${s.lose}</td>
      <td>${s.draw}</td>
    </tr>`;
  });

    html += `</tbody></table>`;
    return html;
  }

  document.getElementById("contentArea").innerHTML =
    buildTable("A çµ„ç›®å‰æˆ°ç¸¾", standingA) +
    "<br>" +
    buildTable("B çµ„ç›®å‰æˆ°ç¸¾", standingB);
}



// ====================================================================
// â­ 3ï¼‰æˆ°ç¸¾æŸ¥è©¢ï¼ˆç­†ç•«æ’åºï¼‰
// ====================================================================
async function renderTeamSearch() {
  const rows = await fetchCSV();
  const data = rows.slice(1);

  const teams = [...new Set(data.flatMap(r => [r[3], r[4]]))].filter(Boolean);

  teams.sort((a, b) => a.localeCompare(b, "zh-Hant"));

  let html = `<h3>æˆ°ç¸¾æŸ¥è©¢</h3>`;

  html += `
    <label>é¸æ“‡éšŠä¼ï¼š
      <select id="teamSelect" onchange="filterTeam()">
        <option value="">è«‹é¸æ“‡</option>
  `;

  teams.forEach(t => (html += `<option value="${t}">${t}</option>`));

  html += `</select></label><div id="teamResult"></div>`;

  document.getElementById("contentArea").innerHTML = html;

  window.fullData = data;
}

function filterTeam() {
  const team = document.getElementById("teamSelect").value;
  const result = document.getElementById("teamResult");

  result.innerHTML = "";
  if (!team) return;

  const rows = window.fullData.filter(r => r[3] === team || r[4] === team);

  let html = `
    <table>
      <thead>
        <tr><th>æ—¥æœŸ</th><th>æ™‚é–“</th><th>çµ„åˆ¥</th><th>éšŠä¼æ·º</th><th>éšŠä¼æ·±</th><th>æ¯”æ•¸</th><th>å‹éšŠ</th></tr>
      </thead>
      <tbody>
  `;

  rows.forEach(r => html += `<tr>${r.map(x => `<td>${x}</td>`).join("")}</tr>`);

  html += `</tbody></table>`;
  result.innerHTML = html;
}


// ====================================================================
// â­ 4ï¼‰è¼‰å…¥æ­·å±†æˆç¸¾
// ====================================================================

const HISTORY_CSV_URL =
    "https://docs.google.com/spreadsheets/d/e/2PACX-1vQoTn408A02uDUaRJivPlAs7fRUloehRNYpTv9HO3IOo1BVa7-3T5lUMvhciq3LgI_NToyzVIoEOOuK/pub?output=csv";

// ä¸»ç•«é¢è¼‰å…¥æ­·å±†æˆç¸¾
async function renderHistory() {
    const content = document.getElementById("contentArea");

    content.innerHTML = `
        <h3>æ­·å±†æˆç¸¾</h3>
        <label>é¸æ“‡è³½å­£ï¼š
            <select id="historySelect" onchange="loadHistorySeason()"></select>
        </label>
        <div id="historyResult" style="margin-top: 15px;"></div>
    `;

    await loadHistorySeasonList();
}

// è®€å– Google Sheet CSV â†’ å»ºç«‹è³½å­£ä¸‹æ‹‰é¸å–®
async function loadHistorySeasonList() {
    const res = await fetch(HISTORY_CSV_URL);
    const text = await res.text();

    const rows = text.split(/\r?\n/).map(r => r.split(","));
    const data = rows.slice(1).filter(r => r.length > 1);

    /*
      æ¬„ä½å‡è¨­ï¼š
      [0] æ’åºç¢¼ï¼ˆ202601ï¼‰
      [1] è³½å­£æ–‡å­—ï¼ˆ2026ç¬¬ä¸€å­£ï¼‰
      [2] çµ„åˆ¥
      [3] çé …
      [4] éšŠä¼
    */

    // å»ºç«‹ Mapï¼šæ’åºç¢¼ â†’ è³½å­£åç¨±ï¼ˆé¿å…é‡è¤‡ï¼‰
    const seasonMap = new Map();
    data.forEach(r => {
        seasonMap.set(r[0], r[1]);
    });

    // ä¾æ’åºç¢¼ã€Œæ•¸å­—å¤§åˆ°å°ã€æ’åº
    const sortedKeys = [...seasonMap.keys()]
        .map(k => Number(k))
        .sort((a, b) => b - a);

    const select = document.getElementById("historySelect");
    select.innerHTML = "";

    sortedKeys.forEach(key => {
        const opt = document.createElement("option");
        opt.value = key;                  // ç”¨æ’åºç¢¼ç•¶ value
        opt.textContent = seasonMap.get(String(key)); // é¡¯ç¤ºè³½å­£æ–‡å­—
        select.appendChild(opt);
    });

    // é è¨­è¼‰å…¥æœ€æ–°ä¸€å­£ï¼ˆæ’åºå¾Œç¬¬ä¸€ç­†ï¼‰
    loadHistorySeason();
}

// é¡¯ç¤ºç‰¹å®šè³½å­£çš„ Aã€B çµ„æˆç¸¾
async function loadHistorySeason() {
    const seasonKey = document.getElementById("historySelect").value;

    const res = await fetch(HISTORY_CSV_URL);
    const text = await res.text();

    const rows = text.split(/\r?\n/).map(r => r.split(","));
    const headers = rows[0].slice(1); // â—ä¸é¡¯ç¤ºæ’åºç¢¼æ¬„
    const data = rows.slice(1).filter(r => r.length > 1);

    // ç¯©é¸è©²è³½å­£ï¼ˆç”¨æ’åºç¢¼ï¼‰
    const filtered = data.filter(r => r[0] === seasonKey);

    // A / B çµ„
    const A = filtered.filter(r => r[2] === "Açµ„");
    const B = filtered.filter(r => r[2] === "Bçµ„");

    let html = "";

    function makeTable(title, rows) {
        if (rows.length === 0) return "";

        return `
            <h3>${title}</h3>
            <table>
                <thead>
                    <tr>${headers.map(h => `<th>${h}</th>`).join("")}</tr>
                </thead>
                <tbody>
                    ${rows
                        .map(r => `
                            <tr>
                                ${r.slice(1).map(x => `<td>${x}</td>`).join("")}
                            </tr>
                        `)
                        .join("")}
                </tbody>
            </table>
            <br>
        `;
    }

    html += makeTable("A çµ„æˆç¸¾", A);
    html += makeTable("B çµ„æˆç¸¾", B);

    document.getElementById("historyResult").innerHTML = html;
}

// â­ é è¨­é¡¯ç¤ºæœ€æ–°æ¶ˆæ¯
renderNews();

</script>

</body>
</html>
